<!DOCTYPE html SYSTEM "about:legacy-compat">
<html manifest="pamflet.manifest">
      <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <title>TypeQuux — Understanding Constraints</title>
        
        <link rel="stylesheet" href="css/blueprint/screen.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/blueprint/grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="css/blueprint/print.css" type="text/css" media="print"/> 
        <!--[if lt IE 8]>
          <link rel="stylesheet" href={ relativeBase + "css/blueprint/ie.css" } type="text/css" media="screen, projection"/>
        <![endif]-->
        <link rel="stylesheet" href="css/pamflet.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/pamflet-print.css" type="text/css" media="print"/>
        <link rel="stylesheet" href="css/pamflet-grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="css/color_scheme-redmond.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/color_scheme-github.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/color_scheme-monokai.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/pamfletheight_2em_2em.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
        <script type="text/javascript" src="js/jquery.collapse.js"></script>
        <script type="text/javascript" src="js/pamflet.js"></script>
        <script type="text/javascript">
          Pamflet.page.language = 'en';
        </script>
        <script type="text/javascript" src="js/prettify/prettify.js"></script><script type="text/javascript" src="js/prettify/lang-scala.js"></script><link type="text/css" rel="stylesheet" href="css/prettify.css"/><script type="text/javascript"><!--
        window.onload=function() { prettyPrint(); };
      --></script>
        <link rel="stylesheet" href="css/style.css" type="text/css" media="screen, projection"/>
        
        
      </head>
      <body class="color_scheme-redmond">
        <a class="page prev nav" href="Records.html">
            <span class="space">&nbsp;</span>
            <span class="flip arrow">❧</span>
          </a><a class="page next nav" href="Contents+in+Depth.html">
            <span class="space">&nbsp;</span>
            <span class="arrow">❧</span>
          </a>
        <div class="container contentswrapper">
          <div class="span-16 prepend-1 append-1 contents">
            <h2 id="Understanding+Constraints">Understanding Constraints<a href="#Understanding+Constraints" class="header-link"><span class="header-link-content">&nbsp;</span></a></h2><p>Constraints are composable typeclasses that abstract over the specifics of primitives likes HLists and Records to encode an 
invariant associated with a problem. They are the central conceptual abstraction of operations on the primitives that ship
with TypeQuux and play the major role in supporting the claim that the library is <em>hackable</em>.
</p><p>As an example, consider the <code>TakeConstraint</code>:
</p><pre><code class="prettyprint lang-scala">trait TakeConstraint[N, HL, R] {
  def apply(hl: HL): R
}
</code></pre><p>The invariant that it encodes is that given an object of type <code>HL</code>, the type of the first <code>N</code> elements is <code>R</code>. The semantics are of course
enforced by convention, but are consistent in the default implementations for <code>TakeConstraint</code> that ship with the library. 
</p><p>If you leave all three type parameters unconstrained, the code will compile for all types for which such a constraint can be satisfied, 
regardless of arity or the specific primitive. 
</p><pre><code class="prettyprint lang-scala">scala&gt; import typequux._; import typequux._; import TupleOps._; import constraint._
import typequux._
import typequux._
import TupleOps._
import constraint._

scala&gt; def uncons[T, R](i: LiteralHash[Int], t: T)(implicit ev: TakeConstraint[i.ValueHash, T, R]): R = ev(t)
uncons: [T, R](i: typequux.LiteralHash[Int], t: T)(implicit ev: typequux.constraint.TakeConstraint[i.ValueHash,T,R])R

scala&gt; uncons(2, (true, &quot;foo&quot;, 42)) // tuple
res0: (Boolean, String) = (true,foo)

scala&gt; uncons(2, (true, &quot;foo&quot;, List(3.14159, 2.71828), 42L, Some(&quot;bananas&quot;))) // tuple
res1: (Boolean, String) = (true,foo)

scala&gt; uncons(2, Some(&quot;bananas&quot;) :+: &quot;watermelon&quot; :+: 0 :+: HNil) // HList
res3: /**/ = Some(bananas) :+: watermelon :+: HNil

scala&gt; uncons(4, (12, &quot;22/7&quot;)) // does not compile
</code></pre><p>If you fix type <code>T</code>, it constrains the indices for which the expression compiles and also the primitives that are valid.
</p><pre><code class="prettyprint lang-scala">scala&gt; def constr1[R](i: LiteralHash[Int], t: (Int, String, Boolean))(implicit ev: TakeConstraint[i.ValueHash, (Int, String, Boolean), R]): R = ev(t)
constr1: [R](i: typequux.LiteralHash[Int], t: (Int, String, Boolean))(implicit ev: typequux.constraint.TakeConstraint[i.ValueHash,(Int, String, Boolean),R])R

scala&gt; constr1(1, (42, &quot;foo&quot;, true))
res6: Int = 42

scala&gt; constr1(2, (42, &quot;foo&quot;, true))
res7: (Int, String) = (42,foo)

scala&gt; constr1(4, (42, &quot;foo&quot;, true)) // does not compile
</code></pre><p>If you fix type <code>R</code>, it constrains the shape of the input and also constrains the index to a singular value.
</p><pre><code class="prettyprint lang-scala">scala&gt; def constr2[T](i: LiteralHash[Int], t: T)(implicit ev: TakeConstraint[i.ValueHash, T, (Int, Boolean)]): (Int, Boolean) = ev(t)
constr2: [T](i: typequux.LiteralHash[Int], t: T)(implicit ev: typequux.constraint.TakeConstraint[i.ValueHash,T,(Int, Boolean)])(Int, Boolean)

scala&gt; constr2(2, (42, true, List(1, 2,3)))
res10: (Int, Boolean) = (42,true)

scala&gt; constr2(2, (42, true, Some(List(true, false)), &quot;oogachaka&quot;, ('t', 'q')))
res11: (Int, Boolean) = (42,true)

scala&gt; constr2(3, (42, true, Some(List(true, false)), &quot;oogachaka&quot;, ('t', 'q'))) // does not compile

scala&gt; constr2(2, (42)) // does not compile
</code></pre><p>Constraints are composable. They can be combined with other constraints to encode very granular problem requirements. 
(This is infact how most of the library is implemented). Consider the following (very hypothetical) scenario: 
</p><p>You have to take the first k elements of a primitive (arity and type is unconstrained), but they have to be convertable to a 
list of <code>Option[AnyRef]</code>. In the real world, the least upper bound type would be some sort of a business object, but 
to keep things simple, lets say that its an <code>AnyRef</code>.
</p><pre><code class="prettyprint lang-scala">scala&gt; def constr3[T, R](i: LiteralHash[Int], t: T)(implicit ev0: TakeConstraint[i.ValueHash, T, R], ev1: ToListConstraint[R, Option[AnyRef]]): List[Option[AnyRef]] = ev1(ev0(t))
constr3: [T, R](i: typequux.LiteralHash[Int], t: T)(implicit ev0: typequux.constraint.TakeConstraint[i.ValueHash,T,R], implicit ev1: typequux.constraint.ToListConstraint[R,Option[AnyRef]])List[Option[AnyRef]]

scala&gt; constr3(2, (Some(&quot;oogachaka&quot;), None, Some(List(1,2 ,3))))
res24: List[Option[Object]] = List(Some(oogachaka), None)

scala&gt; constr3(3, (None, Some(Set(true, false, false)), Some(&quot;oogachaka&quot;), None, Some(List(1,2 ,3))))
res25: List[Option[Object]] = List(None, Some(Set(true, false)), Some(oogachaka))

scala&gt; constr3(3, None :+: Some(&quot;matt le blanc&quot;) :+: Some(List(&quot;trevor noah&quot;, &quot;john oliver&quot;)) :+: None :+: HNil)
res27: List[Option[Object]] = List(None, Some(matt le blanc), Some(List(trevor noah, john oliver)))

scala&gt; constr3(2, Some(12) :+: Some(&quot;matt le blanc&quot;) :+: Some(List(&quot;jon stewart&quot;, &quot;jay leno&quot;)) :+: None :+: HNil) // does not compile, Int is not a subtype of AnyRef

scala&gt; constr3(5, (Some(&quot;foo&quot;), None)) // does not compile, cannot take
</code></pre><p>If this is a constraint that is recurrent in several parts of your program or you wish to make the code easier to read, you
can refactor it like so:
</p><pre><code class="prettyprint lang-scala">scala&gt; :paste
// Entering paste mode (ctrl-D to finish)

trait MyConstraint[N, R]{
  def apply(r: R): List[AnyRef]
}

object MyConstraint{
  implicit def build[N, R, T](
    implicit ev0: TakeConstraint[N, R, T], ev1: ToListConstraint[T, AnyRef]): MyConstraint[N, R] =
      new MyConstraint[N, R]{
        override def apply(r: R) = ev1(ev0(r))
      }
}


// Exiting paste mode, now interpreting.

defined trait MyConstraint
defined object MyConstraint

scala&gt; def constr4[R](i: LiteralHash[Int], r: R)(implicit ev: MyConstraint[i.ValueHash, R]): List[AnyRef] = ev(r)
constr4: [R](i: typequux.LiteralHash[Int], r: R)(implicit ev: MyConstraint[i.ValueHash,R])List[AnyRef]

scala&gt; constr4(2, (Some(&quot;oogachaka&quot;), None, Some(List(1,2 ,3))))
res32: List[Object] = List(Some(oogachaka), None)

scala&gt; constr4(3, (None, Some(Set(true, false, false)), Some(&quot;oogachaka&quot;), None, Some(List(1,2 ,3))))
res33: List[Object] = List(None, Some(Set(true, false)), Some(oogachaka))

scala&gt; constr4(3, None :+: Some(&quot;matt le blanc&quot;) :+: Some(List(&quot;trevor noah&quot;, &quot;john oliver&quot;)) :+: None :+: HNil)
res34: List[Object] = List(None, Some(matt le blanc), Some(List(trevor noah, john oliver)))

scala&gt; constr4(5, (Some(&quot;foo&quot;), None)) // does not compile

scala&gt; constr4(2, 'c' :+: Some(&quot;matt le blanc&quot;) :+: Some(List(&quot;jon stewart&quot;, &quot;jay leno&quot;)) :+: None :+: HNil) // does not compile
</code></pre><p>There are 40 constraints that ship with the current version of the library. You can check them out in the API.</p><div class="bottom nav end span-16">
                        
                      </div><div class="tocwrapper show">
      <a class="tochead nav" style="display: none" href="#toc">❦</a>
      <a name="toc"></a>
      <h4 class="toctitle">Contents</h4>
      <div class="tocbody">
      <div><a href="TypeQuux.html">TypeQuux</a></div><ol class="toc"> <li><div><a href="Two+Quick+Examples.html">Two Quick Examples</a></div></li><li><div><a href="Pre+Requisites.html">Pre Requisites</a></div></li><li><div><a href="Usage.html">Usage</a></div><ol class="toc"> <li><div><a href="Church+Encoding+of+Booleans.html">Church Encoding of Booleans</a></div></li><li><div><a href="Peano+Numbers.html">Peano Numbers</a></div></li><li><div><a href="Dense+Numbers.html">Dense Numbers</a></div></li><li><div><a href="Type+Sets.html">Type Sets</a></div></li><li><div><a href="Type+Maps.html">Type Maps</a></div></li><li><div><a href="Natural+Transformations.html">Natural Transformations</a></div></li><li><div><a href="Type-Unions+and+Exclusions.html">Type-Unions and Exclusions</a></div></li><li><div><a href="Singleton+Types+for+Literals.html">Singleton Types for Literals</a></div></li><li><div><a href="Covariant+Heterogenous+Lists.html">Covariant Heterogenous Lists</a></div></li><li><div><a href="Tuple+Ops.html">Tuple Ops</a></div></li><li><div><a href="Sized+Vectors.html">Sized Vectors</a></div></li><li><div><a href="String+Indexed+Collections.html">String Indexed Collections</a></div></li><li><div><a href="Records.html">Records</a></div></li><li><div class="current">Understanding Constraints</div></li> </ol></li><li class="generated"><div><a href="Contents+in+Depth.html">Contents in Depth</a></div></li><li class="generated"><div><a href="Combined+Pages.html">Combined Pages</a></div></li> </ol></div></div>
          </div>
        </div>
        <div class="header">
          <div class="container">
        <div class="span-16 prepend-1 append-1">
          <div class="span-16 top nav">
            <div class="span-16 title">
              <span>TypeQuux</span> — Understanding Constraints
            </div>
          </div>
        </div>
      </div>
        </div>
        <div class="footer">
          
        </div>
        <a href="http://github.com/harshad-deo/typequux" class="fork nav"><img src="img/fork.png" alt="Fork me on GitHub"/></a>
        
      </body>
    </html>